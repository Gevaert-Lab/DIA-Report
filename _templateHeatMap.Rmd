

```{r echo=FALSE, message=FALSE,}
library(pheatmap)
library(dplyr)
library(heatmaply)

#source('utils_function.R')

#required_packages = c("dplyr","heatmaply")
#print(required_packages)
#check_dependencies(required_packages)

log_info('Inside HEatmap')
#selected <- data$toptable %>% filter(differential_expressed %in% c('UP','DOWN'))%>% rownames_to_column(var = "rowname") %>% pull(rowname) 

selected <- data$toptable %>% filter(differential_expressed %in% c('UP','DOWN'))  %>% pull(Uniprot_id)

app <- as.data.frame(colData(pe)) %>% filter( Group %in% sample_rel)%>% arrange(Group) %>% dplyr::select(- SampleName)  

data <-  assay(pe[["proteinRS"]])[selected,rownames(app)]

log_info(dim(data)[1])
log_info(dim(data)[2])
if (dim(data)[1] > 5) {
  #   if (dim(data)[1] >= 50 & dim(data)[2] < 25){
  #     w <- 800
  #     h <- 1200
  # }else{
  #     w <- 800
  #     h <-  700
  # }
  log_info('Plotting HEatmap')
  log_info("{paste(dim(data), collapse = '\n')}")
  log_info(file.path(path,paste0("Heatmap_DE_proteins",".pdf")))
  
  heatmaply::heatmaply(data, scale = "column" , dendrogram =  "none", width = 1000 , height =900 , file =  file.path(path,paste0("Heatmap_DE_proteins",".pdf")),  cexRow = 1 )
    
  #   
  # tmp <- heatmaply::heatmaply(data, scale = "column",  dendrogram = "none",cexRow = 1, file =  file.path(path,paste0("Heatmap_DE_proteins",".pdf")))
  #   rm(tmp)
  } else {
    cat ('Not enough DE proteins')
  }  

 #  pdf(file = file.path(path,paste0("Heatmap_DE_proteins",".pdf")))
 #  p = pheatmap::pheatmap(data,
 #                             cluster_rows = FALSE,
 #                             scale = 'row',
 #                            show_rownames = TRUE,
 #                           show_colnames = FALSE,
 #                            annotation_col = app,
 #                            cluster_cols = FALSE,
 #                            fontsize_row = 10,
 #                            fontsize_col = 11,
 #                            width = 40,
 #                            height = 45,
 #                            main = 'Heatmap DE proteins')
 #   
 # print(p)
 #  dev.off()


```